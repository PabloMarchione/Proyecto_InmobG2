/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package inmobiliaria_mddp.vistas;

import inmobiliaria_mddp.accesoDatos.CalquilerData;
import inmobiliaria_mddp.accesoDatos.InmuebleData;
import inmobiliaria_mddp.accesoDatos.InquilinoData;
import inmobiliaria_mddp.entidades.Calquiler;
import inmobiliaria_mddp.entidades.Inmueble;
import inmobiliaria_mddp.entidades.Inquilino;
import java.time.ZoneId;
import java.util.Date;
import java.util.List;
import javax.swing.JOptionPane;
/**
 *
 * @author marti
 */
public class GestionCalquileres extends javax.swing.JInternalFrame {

    /**
     * Creates new form GestionCalquileres
     */
    public GestionCalquileres() {
        initComponents();
        cargarComboInqui();
        cargarComboInmu();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jL_tituloCalquis = new javax.swing.JLabel();
        jB_buscar = new javax.swing.JButton();
        jL_codigo = new javax.swing.JLabel();
        jTF_codigo_ID = new javax.swing.JTextField();
        jL_inquilino = new javax.swing.JLabel();
        jCB_inquilino = new javax.swing.JComboBox<>();
        jTF_garante = new javax.swing.JTextField();
        jL_garante = new javax.swing.JLabel();
        jL_inmueble = new javax.swing.JLabel();
        jCB_inmueble = new javax.swing.JComboBox<>();
        jL_propietario = new javax.swing.JLabel();
        jTF_propietario = new javax.swing.JTextField();
        jL_fechaIni = new javax.swing.JLabel();
        jDCH_fechaIni = new com.toedter.calendar.JDateChooser();
        jL_fechaFin = new javax.swing.JLabel();
        jDCH_fechaFin = new com.toedter.calendar.JDateChooser();
        jL_monto = new javax.swing.JLabel();
        jTF_monto = new javax.swing.JTextField();
        jB_nuevo = new javax.swing.JButton();
        jB_guardar = new javax.swing.JButton();
        jB_eliminar = new javax.swing.JButton();
        jB_salir = new javax.swing.JButton();

        jL_tituloCalquis.setFont(new java.awt.Font("Segoe UI", 3, 18)); // NOI18N
        jL_tituloCalquis.setText("CONTROL DE CONTRATOS");

        jB_buscar.setText("Buscar");
        jB_buscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jB_buscarActionPerformed(evt);
            }
        });

        jL_codigo.setText("CÃ³digo:");

        jTF_codigo_ID.setText(" ");
        jTF_codigo_ID.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTF_codigo_IDActionPerformed(evt);
            }
        });

        jL_inquilino.setText("Inquilino:");

        jTF_garante.setEditable(false);
        jTF_garante.setText(" ");

        jL_garante.setText("Garante:");

        jL_inmueble.setText("Inmueble:");

        jL_propietario.setText("Propietario:");

        jTF_propietario.setEditable(false);

        jL_fechaIni.setText("Desde:");

        jL_fechaFin.setText("Hasta:");

        jL_monto.setText("Monto:");

        jTF_monto.setText(" ");

        jB_nuevo.setText("Nuevo");

        jB_guardar.setText("Guardar");

        jB_eliminar.setText("Eliminar");

        jB_salir.setText("Salir");
        jB_salir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jB_salirActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jL_inquilino)
                                    .addComponent(jL_garante)
                                    .addComponent(jL_codigo))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                        .addComponent(jTF_codigo_ID, javax.swing.GroupLayout.DEFAULT_SIZE, 165, Short.MAX_VALUE)
                                        .addGap(84, 84, 84)
                                        .addComponent(jB_buscar))
                                    .addComponent(jTF_garante, javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(jCB_inquilino, javax.swing.GroupLayout.Alignment.TRAILING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jL_propietario)
                                    .addComponent(jL_inmueble))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jCB_inmueble, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jTF_propietario)
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                        .addComponent(jDCH_fechaFin, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jDCH_fechaIni, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jTF_monto))
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jB_guardar)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(jB_eliminar)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(jB_salir))))))
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                            .addContainerGap()
                            .addComponent(jL_fechaIni))
                        .addGroup(layout.createSequentialGroup()
                            .addContainerGap()
                            .addComponent(jL_fechaFin))
                        .addGroup(layout.createSequentialGroup()
                            .addContainerGap()
                            .addComponent(jL_monto))
                        .addGroup(layout.createSequentialGroup()
                            .addContainerGap()
                            .addComponent(jB_nuevo))
                        .addGroup(layout.createSequentialGroup()
                            .addGap(65, 65, 65)
                            .addComponent(jL_tituloCalquis, javax.swing.GroupLayout.PREFERRED_SIZE, 230, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(102, 102, 102))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jL_tituloCalquis, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jB_buscar)
                    .addComponent(jL_codigo)
                    .addComponent(jTF_codigo_ID, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jL_inquilino)
                    .addComponent(jCB_inquilino, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jL_garante)
                    .addComponent(jTF_garante, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jL_inmueble)
                    .addComponent(jCB_inmueble, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jL_propietario)
                    .addComponent(jTF_propietario, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(38, 38, 38)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jL_fechaIni)
                    .addComponent(jDCH_fechaIni, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(35, 35, 35)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jL_fechaFin)
                    .addComponent(jDCH_fechaFin, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(45, 45, 45)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jL_monto)
                    .addComponent(jTF_monto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 74, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jB_nuevo)
                    .addComponent(jB_guardar)
                    .addComponent(jB_eliminar)
                    .addComponent(jB_salir))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jTF_codigo_IDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTF_codigo_IDActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTF_codigo_IDActionPerformed

    private void jB_buscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jB_buscarActionPerformed
        //deshabilitar "guardar" si codigo devuelve un resultado vÃ¡lido
        //primero verifico que codigo no estÃ© vacÃ­o, y que sea un dato vÃ¡lido con try catch
        //elimino los espacios de barra, tabulacion o salto de linea con el replaceAll(primer parametro es el "falso" espacio vacio, segundo parametro es el espacio vacio posta
        String idCadena = jTF_codigo_ID.getText().replaceAll("\\s", "");
        try
        {
            int id = Integer.parseInt(idCadena);
            //instancio un calquilerData para acceder a sus metodos
            CalquilerData calquiData = new CalquilerData();
            //instancio un contrato para recibir datos
            Calquiler calqui = new Calquiler();
            calqui = calquiData.buscarContrato(id);
            //si me devuelve null, no existe ese contrato
            if (calqui == null)
            {
                //borramos y nos vamos. el mÃ©todo buscar ya tiene su aviso de No Encontrado
                jTF_codigo_ID.setText("");
                return;
            }
            else
            {
                //Â¿deshabilito "guardar" para evitar duplicados?
                //cargo datos en formulario
                jCB_inquilino.setSelectedItem(calqui.getInquilino());
                jTF_garante.setText(calqui.getInquilino().getNomCompletoGa());
                jCB_inmueble.setSelectedItem(calqui.getInmueble());
                jTF_propietario.setText(calqui.getInmueble().getPropietario().getApellido());
                //localDate : estu.getFechaNac()
                //transforma localDate a instant: atStartOfDay(ZoneId.systemDefault()).toInstant()
                //Date.from(Instant) trnasforma instant a date
                jDCH_fechaIni.setDate(Date.from(calqui.getFechaIni().atStartOfDay(ZoneId.systemDefault()).toInstant()));
                jDCH_fechaFin.setDate(Date.from(calqui.getFechaFin().atStartOfDay(ZoneId.systemDefault()).toInstant()));
                jTF_monto.setText("" + calqui.getPrecioAlquiler()); //una manera de convertir int a string, sumarle una cadena vacÃ­a
                //deberÃ­a apagar boton para guardar, porque ese alumno ya existe, pero sino, no puedo acceder a "modificar" desde ese mismo boton
                //jBguardar.setEnabled(false);
                //Â¿agregar botÃ³n de "editar" para modificar datos????
            }
        }
        //NumberFormatException se arroja si hay espacios vacios, o numeros reales 
        catch(NumberFormatException nfe)
        {
            JOptionPane.showMessageDialog(this, "Ingrese un nÃºmero valido");
            jTF_codigo_ID.setText("");
            return;
        }
    }//GEN-LAST:event_jB_buscarActionPerformed

    private void jB_salirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jB_salirActionPerformed
        int choice = JOptionPane.showConfirmDialog(this, "Â¿Salir de esta ventana?", "ConfirmaciÃ³n", JOptionPane.YES_NO_OPTION);
        if (choice == JOptionPane.YES_OPTION) 
        {
            // con dispose salimos del internal frame. Para salir x completo: "System.exit(0);"
            this.dispose();
        }
    }//GEN-LAST:event_jB_salirActionPerformed

    private void cargarComboInqui()
    {
        //instanciar un InquilinoData para acceder a sus mÃ©todos
        InquilinoData inquiData = new InquilinoData();
        //List<Inquilino> inquiList = inquiData.//nombre del metodo que devuelve lista de todos los inquilinos
    }
    
    private void cargarComboInmu()
    {
        //instanciar un InmuebleData para acceder a sus mÃ©todos
        InmuebleData inmuData = new InmuebleData();
        List<Inmueble> inmuList = inmuData.listarInmuebles();
        //con un for each -enhanced for- voy agregando al comboBox
        for (Inmueble aux : inmuList)
        {
            jCB_inmueble.addItem(aux);
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jB_buscar;
    private javax.swing.JButton jB_eliminar;
    private javax.swing.JButton jB_guardar;
    private javax.swing.JButton jB_nuevo;
    private javax.swing.JButton jB_salir;
    private javax.swing.JComboBox<Inmueble> jCB_inmueble;
    private javax.swing.JComboBox<Inquilino> jCB_inquilino;
    private com.toedter.calendar.JDateChooser jDCH_fechaFin;
    private com.toedter.calendar.JDateChooser jDCH_fechaIni;
    private javax.swing.JLabel jL_codigo;
    private javax.swing.JLabel jL_fechaFin;
    private javax.swing.JLabel jL_fechaIni;
    private javax.swing.JLabel jL_garante;
    private javax.swing.JLabel jL_inmueble;
    private javax.swing.JLabel jL_inquilino;
    private javax.swing.JLabel jL_monto;
    private javax.swing.JLabel jL_propietario;
    private javax.swing.JLabel jL_tituloCalquis;
    private javax.swing.JTextField jTF_codigo_ID;
    private javax.swing.JTextField jTF_garante;
    private javax.swing.JTextField jTF_monto;
    private javax.swing.JTextField jTF_propietario;
    // End of variables declaration//GEN-END:variables
}
